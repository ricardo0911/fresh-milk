<!-- pages/coupon/coupon.wxml - ä¼˜æƒ åˆ¸ä¸­å¿ƒ -->
<view class="page-coupon">
  <!-- æ ‡ç­¾ -->
  <view class="tabs">
    <view class="tab {{currentTab === 'available' ? 'active' : ''}}" bindtap="switchTab" data-tab="available">
      é¢†åˆ¸ä¸­å¿ƒ
    </view>
    <view class="tab {{currentTab === 'my' ? 'active' : ''}}" bindtap="switchTab" data-tab="my">
      æˆ‘çš„ä¼˜æƒ åˆ¸
    </view>
  </view>

  <!-- å¯é¢†å–ä¼˜æƒ åˆ¸ -->
  <view class="coupon-list" wx:if="{{currentTab === 'available'}}">
    <view class="coupon-card" wx:for="{{availableCoupons}}" wx:key="id">
      <view class="coupon-left">
        <view class="coupon-amount">
          <text class="amount-symbol">Â¥</text>
          <text class="amount-value">{{item.amount}}</text>
        </view>
        <text class="coupon-condition">æ»¡{{item.min_amount}}å¯ç”¨</text>
      </view>
      <view class="coupon-center">
        <text class="coupon-name">{{item.name}}</text>
        <text class="coupon-desc">{{item.description}}</text>
        <text class="coupon-expire">{{item.expire_date}}å‰æœ‰æ•ˆ</text>
      </view>
      <view class="coupon-action">
        <button class="claim-btn" catchtap="claimCoupon" data-id="{{item.id}}">é¢†å–</button>
      </view>
    </view>
    
    <view class="empty-state" wx:if="{{availableCoupons.length === 0}}">
      <text class="empty-icon">ğŸ«</text>
      <text class="empty-text">æš‚æ— å¯é¢†å–çš„ä¼˜æƒ åˆ¸</text>
    </view>
  </view>

  <!-- æˆ‘çš„ä¼˜æƒ åˆ¸ -->
  <view class="coupon-list" wx:if="{{currentTab === 'my'}}">
    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="status-filter">
      <text class="filter-item {{statusFilter === 'unused' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="unused">æœªä½¿ç”¨</text>
      <text class="filter-item {{statusFilter === 'used' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="used">å·²ä½¿ç”¨</text>
      <text class="filter-item {{statusFilter === 'expired' ? 'active' : ''}}" bindtap="setStatusFilter" data-status="expired">å·²è¿‡æœŸ</text>
    </view>

    <view class="coupon-card {{item.status !== 'unused' ? 'disabled' : ''}}" wx:for="{{myCoupons}}" wx:key="id">
      <view class="coupon-left">
        <view class="coupon-amount">
          <text class="amount-symbol">Â¥</text>
          <text class="amount-value">{{item.amount}}</text>
        </view>
        <text class="coupon-condition">æ»¡{{item.min_amount}}å¯ç”¨</text>
      </view>
      <view class="coupon-center">
        <text class="coupon-name">{{item.name}}</text>
        <text class="coupon-desc">{{item.description}}</text>
        <text class="coupon-expire">{{item.expire_date}}å‰æœ‰æ•ˆ</text>
      </view>
      <view class="coupon-action" wx:if="{{item.status !== 'unused'}}">
        <text class="coupon-status-tag status-{{item.status}}">{{item.status === 'used' ? 'å·²ä½¿ç”¨' : 'å·²è¿‡æœŸ'}}</text>
      </view>
      <view class="coupon-action" wx:else>
        <text class="use-btn">å»ä½¿ç”¨</text>
      </view>
    </view>

    <view class="empty-state" wx:if="{{myCoupons.length === 0}}">
      <text class="empty-icon">ğŸ«</text>
      <text class="empty-text">æš‚æ— ä¼˜æƒ åˆ¸</text>
      <button class="btn btn-primary" bindtap="goToAvailable">å»é¢†åˆ¸</button>
    </view>
  </view>
</view>
