<!--pages/aftersale/aftersale.wxml - å”®åç”³è¯·é¡µé¢-->
<view class="aftersale-page">
    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="order-card" wx:if="{{order}}">
        <view class="order-header">
            <text class="order-no">è®¢å•å·ï¼š{{order.order_no}}</text>
        </view>
        <view class="order-items">
            <view class="item" wx:for="{{order.items}}" wx:key="id">
                <image class="item-image" src="{{item.cover_image}}" mode="aspectFill"/>
                <view class="item-info">
                    <text class="item-name">{{item.name}}</text>
                    <text class="item-spec">{{item.specification}}</text>
                </view>
                <text class="item-qty">Ã—{{item.quantity}}</text>
            </view>
        </view>
    </view>

    <!-- å”®åç±»å‹ -->
    <view class="section">
        <view class="section-title">å”®åç±»å‹</view>
        <view class="type-list">
            <view 
                wx:for="{{typeOptions}}" 
                wx:key="value"
                class="type-item {{selectedType === item.value ? 'active' : ''}}"
                data-type="{{item.value}}"
                bindtap="selectType"
            >
                <view class="type-icon">{{item.icon}}</view>
                <view class="type-content">
                    <text class="type-label">{{item.label}}</text>
                    <text class="type-desc">{{item.desc}}</text>
                </view>
                <view class="type-check" wx:if="{{selectedType === item.value}}">âœ“</view>
            </view>
        </view>
    </view>

    <!-- é€€æ¬¾åŸå›  -->
    <view class="section">
        <view class="section-title">é€€æ¬¾åŸå› </view>
        <picker mode="selector" range="{{reasonOptions}}" bindchange="selectReason">
            <view class="picker-box">
                <text class="picker-value {{selectedReasonIndex >= 0 ? '' : 'placeholder'}}">
                    {{selectedReasonIndex >= 0 ? reasonOptions[selectedReasonIndex] : 'è¯·é€‰æ‹©åŸå› '}}
                </text>
                <text class="picker-arrow">â€º</text>
            </view>
        </picker>
    </view>

    <!-- é—®é¢˜æè¿° -->
    <view class="section">
        <view class="section-title">é—®é¢˜æè¿°ï¼ˆé€‰å¡«ï¼‰</view>
        <textarea 
            class="desc-textarea"
            placeholder="è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜ï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´å¥½åœ°ä¸ºæ‚¨å¤„ç†"
            maxlength="500"
            bindinput="inputDescription"
            value="{{description}}"
        />
        <text class="char-count">{{description.length}}/500</text>
    </view>

    <!-- ä¸Šä¼ å‡­è¯ -->
    <view class="section">
        <view class="section-title">ä¸Šä¼ å‡­è¯ï¼ˆé€‰å¡«ï¼‰</view>
        <view class="image-list">
            <view 
                wx:for="{{images}}" 
                wx:key="index"
                class="image-item"
            >
                <image 
                    src="{{item}}" 
                    mode="aspectFill"
                    data-index="{{index}}"
                    bindtap="previewImage"
                />
                <view 
                    class="delete-btn"
                    data-index="{{index}}"
                    bindtap="deleteImage"
                >Ã—</view>
            </view>
            <view 
                wx:if="{{images.length < 9}}"
                class="upload-btn"
                bindtap="chooseImage"
            >
                <text class="upload-icon">ğŸ“·</text>
                <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
            </view>
        </view>
        <text class="image-tip">æœ€å¤šå¯ä¸Šä¼ 9å¼ å›¾ç‰‡ï¼Œæ”¯æŒjpgã€pngæ ¼å¼</text>
    </view>

    <!-- é€€æ¬¾é‡‘é¢ -->
    <view class="refund-section" wx:if="{{selectedType === 'refund' || selectedType === 'return'}}">
        <view class="refund-row">
            <text class="refund-label">é€€æ¬¾é‡‘é¢</text>
            <text class="refund-amount">Â¥{{refundAmount}}</text>
        </view>
        <text class="refund-tip">é€€æ¬¾å°†åœ¨å®¡æ ¸é€šè¿‡å1-3ä¸ªå·¥ä½œæ—¥å†…åŸè·¯é€€å›</text>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
        <button 
            class="submit-btn {{submitting ? 'disabled' : ''}}"
            bindtap="submitApplication"
            disabled="{{submitting}}"
        >
            {{submitting ? 'æäº¤ä¸­...' : 'æäº¤ç”³è¯·'}}
        </button>
    </view>
</view>
