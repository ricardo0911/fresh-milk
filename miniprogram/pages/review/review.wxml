<!--pages/review/review.wxml - è®¢å•è¯„ä»·é¡µé¢-->
<view class="review-page">
    <!-- é¡¶éƒ¨æç¤º -->
    <view class="review-header">
        <view class="header-icon">âœ¨</view>
        <view class="header-text">
            <text class="title">åˆ†äº«æ‚¨çš„è´­ç‰©ä½“éªŒ</text>
            <text class="subtitle">æ‚¨çš„è¯„ä»·å¯¹å…¶ä»–ç”¨æˆ·å¾ˆæœ‰å¸®åŠ©</text>
        </view>
    </view>

    <!-- è¯„ä»·åˆ—è¡¨ -->
    <view class="review-list">
        <block wx:for="{{reviews}}" wx:key="product_id">
            <view class="review-item">
                <!-- å•†å“ä¿¡æ¯ -->
                <view class="product-info">
                    <image class="product-image" src="{{order.items[index].cover_image}}" mode="aspectFill"/>
                    <view class="product-detail">
                        <text class="product-name">{{order.items[index].name}}</text>
                        <text class="product-spec">{{order.items[index].specification}}</text>
                    </view>
                </view>

                <!-- è¯„åˆ† -->
                <view class="rating-section">
                    <text class="section-label">å•†å“è¯„åˆ†</text>
                    <view class="star-rating">
                        <view 
                            wx:for="{{5}}" 
                            wx:for-item="star" 
                            wx:for-index="starIndex"
                            wx:key="starIndex"
                            class="star {{item.rating > starIndex ? 'active' : ''}}"
                            data-index="{{index}}"
                            data-rating="{{starIndex + 1}}"
                            bindtap="setRating"
                        >â˜…</view>
                    </view>
                    <text class="rating-text">{{item.rating == 5 ? 'éå¸¸æ»¡æ„' : item.rating == 4 ? 'æ»¡æ„' : item.rating == 3 ? 'ä¸€èˆ¬' : item.rating == 2 ? 'ä¸æ»¡æ„' : 'éå¸¸ä¸æ»¡æ„'}}</text>
                </view>

                <!-- è¯„ä»·å†…å®¹ -->
                <view class="content-section">
                    <textarea 
                        class="review-textarea"
                        placeholder="è¯·åˆ†äº«æ‚¨å¯¹è¿™æ¬¾äº§å“çš„ä½¿ç”¨æ„Ÿå—ï¼Œå¦‚å£æ„Ÿã€æ–°é²œåº¦ã€åŒ…è£…ç­‰~"
                        maxlength="500"
                        data-index="{{index}}"
                        bindinput="inputContent"
                        value="{{item.content}}"
                    />
                    <text class="char-count">{{item.content.length}}/500</text>
                </view>

                <!-- å›¾ç‰‡ä¸Šä¼  -->
                <view class="image-section">
                    <view class="image-list">
                        <view 
                            wx:for="{{item.images}}" 
                            wx:for-item="img" 
                            wx:for-index="imgIndex"
                            wx:key="imgIndex"
                            class="image-item"
                        >
                            <image 
                                src="{{img}}" 
                                mode="aspectFill"
                                data-index="{{index}}"
                                data-img-index="{{imgIndex}}"
                                bindtap="previewImage"
                            />
                            <view 
                                class="delete-btn"
                                data-index="{{index}}"
                                data-img-index="{{imgIndex}}"
                                bindtap="deleteImage"
                            >Ã—</view>
                        </view>
                        <view 
                            wx:if="{{item.images.length < 9}}"
                            class="upload-btn"
                            data-index="{{index}}"
                            bindtap="chooseImage"
                        >
                            <text class="upload-icon">ğŸ“·</text>
                            <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
                        </view>
                    </view>
                    <text class="image-tip">æœ€å¤šå¯ä¸Šä¼ 9å¼ å›¾ç‰‡</text>
                </view>

                <!-- åŒ¿åè¯„ä»· -->
                <view class="anonymous-section" data-index="{{index}}" bindtap="toggleAnonymous">
                    <view class="checkbox {{item.is_anonymous ? 'checked' : ''}}">
                        <text wx:if="{{item.is_anonymous}}">âœ“</text>
                    </view>
                    <text class="anonymous-label">åŒ¿åè¯„ä»·</text>
                </view>
            </view>
        </block>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
        <button 
            class="submit-btn {{submitting ? 'disabled' : ''}}"
            bindtap="submitReview"
            disabled="{{submitting}}"
        >
            {{submitting ? 'æäº¤ä¸­...' : 'å‘è¡¨è¯„ä»·'}}
        </button>
    </view>
</view>
