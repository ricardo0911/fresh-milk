# 鲜奶订购系统 - 安装说明

## 一、环境要求

### 1. 必需软件
- **Python 3.10+** (推荐 3.12)
- **Node.js 18+** (推荐 20.x)
- **MySQL 8.0+**
- **微信开发者工具** (用于小程序)

### 2. 下载地址
- Python: https://www.python.org/downloads/
- Node.js: https://nodejs.org/
- MySQL: https://dev.mysql.com/downloads/mysql/
- 微信开发者工具: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

---

## 二、安装步骤

### 1. 安装 MySQL 并导入数据库

```bash
# 登录 MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE fresh_milk_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 退出 MySQL
exit

# 导入数据
mysql -u root -p fresh_milk_db < fresh_milk_db_backup.sql
```

**注意**: 如果 MySQL 密码不是 `root`，需要修改 `config/settings.py` 中的数据库配置：
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'fresh_milk_db',
        'USER': 'root',
        'PASSWORD': '你的密码',  # 修改这里
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

### 2. 安装 Python 依赖

```bash
cd fresh-milk
pip install -r requirements.txt
```

如果安装 mysqlclient 失败，可以只用 pymysql（项目已配置）。

### 3. 安装前端依赖

```bash
cd admin-web
npm install
```

### 4. 启动服务

**方式一：使用启动脚本**
```bash
# 双击运行
startup.bat
```

**方式二：手动启动**

终端1 - 启动后端：
```bash
cd fresh-milk
python manage.py runserver 0.0.0.0:8000
```

终端2 - 启动管理后台：
```bash
cd fresh-milk/admin-web
npm run dev
```

终端3 - 小程序：
用微信开发者工具打开 `miniprogram` 文件夹

---

## 三、访问地址

| 服务 | 地址 |
|------|------|
| 后端 API | http://127.0.0.1:8000 |
| 管理后台 | http://127.0.0.1:3000 |
| 小程序 | 微信开发者工具中预览 |

---

## 四、默认账号

### 管理后台
- 用户名: `admin`
- 密码: `admin123`

### 小程序测试账号
- 手机号: `19223614336`
- 密码: `654321`

---

## 五、常见问题

### 1. Python 命令无效
Windows 应用商店的 Python 可能无法正常工作，建议从官网下载安装，安装时勾选 "Add Python to PATH"。

### 2. MySQL 连接失败
- 确保 MySQL 服务已启动
- 检查用户名密码是否正确
- 检查数据库 `fresh_milk_db` 是否已创建

### 3. npm install 失败
```bash
# 使用淘宝镜像
npm config set registry https://registry.npmmirror.com
npm install
```

### 4. 端口被占用
- 后端默认 8000 端口
- 前端默认 3000 端口
- 可在配置文件中修改

### 5. 小程序请求失败
确保后端服务已启动，且 `miniprogram/utils/api.js` 中的 `BASE_URL` 配置正确：
```javascript
const BASE_URL = 'http://127.0.0.1:8000/api/v1';
```

---

## 六、项目结构

```
fresh-milk/
├── apps/                 # Django 应用
│   ├── users/           # 用户模块
│   ├── products/        # 产品模块
│   ├── orders/          # 订单模块
│   ├── comments/        # 评价模块
│   ├── feedback/        # 反馈模块
│   ├── coupons/         # 优惠券模块
│   └── ...
├── config/              # Django 配置
├── admin-web/           # Vue3 管理后台
├── miniprogram/         # 微信小程序
├── media/               # 上传文件目录
├── requirements.txt     # Python 依赖
└── startup.bat          # 启动脚本
```

---

## 七、需要给朋友的文件

1. **整个 fresh-milk 文件夹**
2. **fresh_milk_db_backup.sql** (数据库备份文件)

运行 `export_db.bat` 导出数据库备份文件。
